<div>
  <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }"></ngx-loading>

  <div *ngIf="release">
    <div class="row">
      <div class="col-md-12 ">
        <div class="card card hero-card text-center mb-4">
          <form name="frmRelease" #frmRelease="ngForm" (ngSubmit)="submitForm(frmRelease)">
            <div class="card-header hero-card-header d-flex flex-row align-items-center">
              <div class="mr-auto font-16" *ngIf="release">Manage Release: {{release.applicationVersion}}</div>
              <ul class="nav nav-pills card-header-pills">
                <li class="nav-item pr-2">
                  <a class="btn btn-outline-secondary" href="#" [routerLink]="['/']">cancel</a>
                </li>
                <li class="nav-item">
                  <span (mouseenter)="mouseOverSave=true" (mouseleave)="mouseOverSave=false">
                    <button class="btn btn-primary" type="submit">save release </button>
                  </span>
                </li>
              </ul>
            </div>
            <div class="card-body">
              <!-- Version -->
              <div class="row  mb-3">               
                <div class="col-sm-2 text-right">
                  <label for="" class="pt-2">Version</label>
                </div>
                <div class="col-sm-8 col-md-6">
                  <input type="text" name="applicationVersion" class="form-control" required pattern="^\d{1,2}\.\d{1,2}\.([0-9]|[x]|[X]){1,2}\+{0,1}$" [(ngModel)]="release.applicationVersion" [ngModelOptions]="{updateOn: 'blur'}">
                  <em *ngIf="!!frmRelease.controls.applicationVersion?.errors?.pattern">
                    Invalid Version Number
                  </em>
                  <em *ngIf="!!frmRelease.controls.applicationVersion?.errors?.required && !!frmRelease.controls.applicationVersion?.touched">
                    Required
                  </em>
                </div>               
              </div>
              <!-- Platform -->
              <div class="row  mb-3">
                <div class="col-sm-2 text-right">
                  <label class="pt-2" for="validationTooltipUsername">Platform</label>
                </div>
                <div class="col-sm-8 col-md-6">
                  <div id="accordion">
                    <div class="card rounded-lg">
                      <div class="card-header py-0" id="headingOne">
                        <div class="row">
                          <div class="col-sm-3 mr-0 border-right p-2 ">
                            <div class="custom-control custom-switch">
                              <input name="iOsRelease" [(ngModel)]="release.iOsRelease" type="checkbox" class="custom-control-input" id="iOsRelease">
                              <label class="custom-control-label" for="iOsRelease">iOS</label>
                            </div>
                          </div>
                          <div class="col-sm-3 mr-0 border-right p-2">
                            <div class="custom-control custom-switch">
                              <input name="androidRelease" [(ngModel)]="release.androidRelease" type="checkbox" class="custom-control-input" id="androidRelease">
                              <label class="custom-control-label" for="androidRelease">Android</label>
                            </div>
                          </div>
                          <div class="col-sm-6 text-right pr-2 pt-2">
                            <div class="btn pt-0 pr-0" (click)="togglePlatformSection()">

                              <i class="fas fa-chevron-down" [hidden]="platformSectionOpened"></i>
                              <i class="fas fa-chevron-up" [hidden]="!platformSectionOpened"></i>

                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="collapse show" aria-labelledby="headingOne" data-parent="#accordion" [hidden]="!platformSectionOpened">
                        <div class="card-body">
                          <div [hidden]="!release.androidRelease && !release.iOsRelease">
                            <div class="row mb-2 mt-4">
                              <div class="col-sm-2"></div>
                              <div class="col-sm-5 text-left font-weight-bold font-12">Platform submitted status</div>
                              <div class="col-sm-5 text-left font-weight-bold pl-1 font-12">In store date</div>
                            </div>
                            <div class="row  mb-3" *ngIf="release.iOsRelease">
                              <div class="col-sm-2 text-right pr-0">
                                <label class="pt-2 text-right" for="validationTooltipUsername">iOS</label>
                              </div>
                              <div class="col-sm-10">
                                <div class="form-row">
                                  <div class="col-sm-6">
                                    <app-date-input-group [(ngModel)]="release.iosPlatfrom.submittedForApprovalDate" name="i-submittedForApprovalDate" size="sm"></app-date-input-group>
                                  </div>
                                  <div class="col-sm-6">
                                    <app-date-input-group [(ngModel)]="release.iosPlatfrom.availableInStoreDate" name="i-availableInStoreDate" size="sm"></app-date-input-group>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="row  mb-3" *ngIf="release.androidRelease">
                              <div class="col-sm-2 text-right pr-0">
                                <label class="pt-2 text-right" for="validationTooltipUsername">Android</label>
                              </div>
                              <div class="col-sm-10">
                                <div class="form-row">
                                  <div class="col-sm-6">
                                    <app-date-input-group [(ngModel)]="release.androidPlatfrom.submittedForApprovalDate" name="a-submittedForApprovalDate" size="sm"></app-date-input-group>
                                  </div>
                                  <div class="col-sm-6">
                                    <app-date-input-group [(ngModel)]="release.androidPlatfrom.availableInStoreDate" name="a-availableInStoreDate" size="sm"></app-date-input-group>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>   

              <!-- Status -->
              <div class="form-group row">
                <label for="" class="col-md-2 col-form-label text-right">Status</label>
                <div class="col-md-9 pt-2 text-left">
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input" id="statusNew" name="statusCode" value="new" [(ngModel)]="release.statusCode">
                    <label class="custom-control-label" for="statusNew">New</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input" id="statusInProgress" name="statusCode" value="inprogress" [(ngModel)]="release.statusCode">
                    <label class="custom-control-label" for="statusInProgress">In Progress</label>
                  </div>
                  <div class="custom-control custom-radio custom-control-inline">
                    <input type="radio" class="custom-control-input" id="statusCompleted" name="statusCode" value="completed" [(ngModel)]="release.statusCode">
                    <label class="custom-control-label" for="statusCompleted">Completed</label>
                  </div>
                </div>
              </div>

              <!-- release -->
              <div class="form-group row">
                <label for="" class="col-md-2 col-form-label text-right">Release date</label>
                <div class="col-md-4 ">
                  <app-date-input-group [(ngModel)]="release.releaseDate" name="releaseDate"></app-date-input-group>
                </div>
              </div>

              <!-- Client -->
              <div class="form-group row">
                <label class="col-md-2 col-form-label text-right">Client</label>
                <div class="col-md-4">
                  <select class="form-control" name="clientId" [(ngModel)]="release.clientId">
                    <option value=""></option>
                    <option [value]="client.clientId" *ngFor="let client of clients"> {{client.clientName}}</option>
                  </select>
                </div>
              </div>

              <!-- qaStartDate -->
              <div class="row  mb-3">
                <div class="col-sm-2 text-right">
                  <label class="pt-2 text-right" for="validationTooltipUsername">QA Dates</label>
                </div>
                <div class="col-sm-8 col-md-6">
                  <div class="form-row">
                    <div class="col-sm-6">
                      <app-date-input-group [(ngModel)]="release.qaStartDate" name="qaStartDate" prepend="from"></app-date-input-group>
                    </div>
                    <div class="col-sm-6">
                      <app-date-input-group [(ngModel)]="release.qaEndDate" name="qaEndDate" prepend="to"></app-date-input-group>
                    </div>
                  </div>
                </div>
              </div>

              <!-- uatStartDate -->
              <div class="row  mb-3">
                <div class="col-sm-2 text-right">
                  <label class="pt-2" for="validationTooltipUsername">UAT Dates</label>
                </div>
                <div class="col-sm-8 col-md-6">
                  <div class="form-row">
                    <div class="col-sm-6">
                      <app-date-input-group [(ngModel)]="release.uatStartDate" name="uatStartDate" prepend="from"></app-date-input-group>
                    </div>
                    <div class="col-sm-6">
                      <app-date-input-group [(ngModel)]="release.uatEndDate" name="uatEndDate" prepend="to"></app-date-input-group>
                    </div>
                  </div>
                </div>
              </div>


              <!-- clientApproverName -->
              <div class="form-group row">
                <label class="col-md-2 col-form-label text-right">Client Approver </label>
                <div class="col-md-6">

                  <input type="text" class="form-control" name="clientApproverName" [(ngModel)]="release.clientApproverName">
                </div>
              </div>

              <div class="form-group row">
                <label class="col-md-2 col-form-label text-right">Notes </label>
                <div class="col-md-10">
                  <textarea class="form-control" name="notes" [(ngModel)]="release.notes"></textarea>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-6">
        <app-collapsible-card cardTitle="Features">
          <div class="form-group">
            <div class="input-group">
              <select class="custom-select" [(ngModel)]="newFeatureId" name="newFeatureId">
                <option value=""></option>
                <option [value]="feature.featureId" *ngFor="let feature of features">{{feature.displayName}}</option>
              </select>
              <div class="input-group-prepend">
                <button class="btn btn-secondary" type="button" (click)="addFeature()"> <i class="fas fa-plus"></i> Add</button>
              </div>
            </div>
          </div>

          <ul class="list-group ">
            <li class="list-group-item" *ngFor="let feature of release.features">
              <div class="d-flex justify-content-between">
                <span>{{feature.feature.displayName}}</span>
                <div>

                  <div class="d-flex">
                    <div class="mr-2">
                      <select [(ngModel)]="feature.statusCode" (change)="featureStatusChanged(feature)" [ngClass]="{'bg-success': feature.statusCode=='completed','bg-primary':feature.statusCode=='inprogress','bg-danger':feature.statusCode=='new'}" class="form-control font-9 rounded-pill  ">
                        <option value="new">New</option>
                        <option value="inprogress">In Progress</option>
                        <option value="completed">Completed</option>
                      </select>
                    </div>
                    <button type="button" class="btn p-0" (click)="removeFeature(feature)">
                      <i class="material-icons md-18 align-middle">close</i>
                    </button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </app-collapsible-card>

      </div>
      <div class="col-md-6">
        <app-collapsible-card cardTitle="Additional Work Items" startCollapsed="false">
          <div class="mb-4" style="margin-top: -20px;margin-left: -20px; margin-right: -20px;;">
            <ul class="nav nav-tabs nav-justified " >
              <li class="nav-item d-flex justify-content-center">
                <button class="btn btn-link nav-link py-3 w-100" (click)="workItem.typeCode='bug'">Bug</button>
              </li>
              <li class="nav-item d-flex justify-content-center">
                <button class="btn btn-link nav-link py-3 w-100" [ngClass]="{active:workItem.typeCode=='enhancmnt'}" (click)="workItem.typeCode='enhancmnt'">Enhancement</button>
              </li>
              <li class="nav-item d-flex justify-content-center">
                <button class="btn btn-link nav-link py-3 w-100" (click)="workItem.typeCode='maint'">Maintenance</button>
              </li>
            </ul>
            <div >
              <div class="form-group ">
                <div class="input-group">
                  <input type="text" class="form-control rounded-0" [(ngModel)]="workItem.title">
                  <div class="input-group-prepend">
                    <button type="button" class="btn btn-secondary" (click)="addWorkItem()"> <i class="fas fa-plus"></i> Add</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <ul class="list-group ">
            <li class="list-group-item" *ngFor="let workItem of release.workItems">
              <div class="d-flex justify-content-between">
                <span> {{workItem.title }}</span>
                <div>
                  <div class="d-flex">
                    <div class="mr-2">
                      <select [(ngModel)]="workItem.statusCode" (change)="workItemStatusChanged(workItem)" [ngClass]="{'bg-success': workItem.statusCode=='completed','bg-primary':workItem.statusCode=='inprogress','bg-danger':workItem.statusCode=='new'}" class="form-control font-9 rounded-pill ">
                        <option value="new">New</option>
                        <option value="inprogress">In Progress</option>
                        <option value="completed">Completed</option>
                      </select>
                    </div>

                    <button type="button" class="btn p-0" (click)="removeWorkItem(workItem)">
                      <i class="material-icons md-18 align-middle">close</i>
                    </button>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </app-collapsible-card>
      </div>
    </div>
  </div>




  <!-- <pre>{{release | json}}</pre> -->
  <br>
</div>
